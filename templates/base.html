<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      /* Skugga och rundning för kort */
      .app-card {
        border-radius: 0.5rem;
        box-shadow: 0 1px 6px rgba(0,0,0,0.06);
      }
      /* Mindre text för hjälprader */
      .help-small { font-size: .85rem; color: #555; }

      /* Gör så att footern alltid ligger längst ned */
      html, body {
        height: 100%;
      }

      body {
        display: flex;
        flex-direction: column;
      }

      /* Gör att main trycker ned footern */
      main {
        flex: 1;
      }

      /* Spinner-overlay */
      #upload-spinner {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 1050;
        background: rgba(255,255,255,0.6);
        backdrop-filter: blur(2px);
        align-items: center;
        justify-content: center;
      }
      #upload-spinner.show {
        display: flex;
      }
    </style>

    <link rel="shortcut icon" type="image/png" href="https://www.esem.se/UI/default/img/favicon-32x32.png" />
    <title>Holy strukturdata</title>
  </head>

  <body class="bg-light">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
      <div class="container">
        <a class="navbar-brand" href="{{ url_for('index') }}">Holy strukturdata</a>
      </div>
    </nav>

    <main class="container mt-4 mb-5">
      {% block content %}{% endblock %}
    </main>

    <footer class="bg-white border-top py-2">
      <div class="container small text-muted text-center">
        Välordnad strukturdata är som balsam för alla inblandade själar
      </div>
    </footer>

    <!-- Spinner overlay -->
    <div id="upload-spinner" aria-hidden="true">
      <div class="text-center">
        <div class="spinner-border" role="status" style="width:3rem;height:3rem;">
          <span class="visually-hidden">Laddar…</span>
        </div>
        <div class="mt-2 small text-muted">Behandlar filen...</div>
      </div>
    </div>

    <!-- Bootstrap JS bundle (inkl. Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Dismiss alert-rutan efter tre sekunder och ta bort från DOM
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
          setTimeout(() => {
            alert.classList.remove('show');
            setTimeout(() => { alert.remove(); }, 300); // Bootstraps fade-tid
          }, 3000);
        });

      // Visa spinner overlay när fil skickas
      document.addEventListener('submit', function (e) {
        const form = e.target;
        if (!(form instanceof HTMLFormElement)) return;

        // Kontrollera att formuläret använder multipart (filuppladdning)
        if (!form.enctype || !form.enctype.includes('multipart/form-data')) return;

        // Om användaren inte valt fil, låt native-validering eller annan JS hantera det
        const fileInput = form.querySelector('input[type="file"]');
        if (fileInput && fileInput.files && fileInput.files.length === 0) {
          return;
        }

        // Visa spinner
        const spinner = document.getElementById('upload-spinner');
        if (spinner) spinner.classList.add('show');

        // Inaktivera submit-knappar
        const submitEls = form.querySelectorAll('input[type="submit"], button[type="submit"], button:not([type])');
        submitEls.forEach(el => { try { el.disabled = true; } catch (_) {} });
      }, true);

      });
    </script>

  </body>
</html>
